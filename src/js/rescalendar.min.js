/*!
Rescalendar.js - https://cesarchas.es/rescalendar
Licensed under the MIT license - http://opensource.org/licenses/MIT

Copyright (c) 2019 CÃ©sar Chas
*/

!function(t){t.fn.rescalendar=function(a){function e(t){return['<div class="error_wrapper">','<div class="thumbnail_image vertical-center">',"<p>",'<span class="error">',t,"</span>","</p>","</div>","</div>"].join("")}function n(t,a,e){if(t==a||t==e)return!0;var n=moment(a,l.format),r=moment(e,l.format);return moment(t,l.format).isBetween(n,r,null,"[]")}function r(t,a,e){for(var r={},o=0;o<t.length;o++)if(a==(r=t[o]).name&&n(e,r.startDate,r.endDate))return r;return!1}function o(a,e){for(var n=l.format,d=moment(e,n).subtract(l.jumpSize,"days"),s=(moment(e,n).add(l.jumpSize,"days"),moment().startOf("day")),i='<td class="firstColumn"></td>',c="",f="",m="",u="",_=0,v="",y="",p="",b="",D=a.find("input.refDate").val(),h=0;h<l.calSize+1;h++)b="",f=(c=moment(d).add(h,"days")).format(n),m=c.format("DD"),v=c.locale(l.locale).format("MMM").replace(".",""),u=c.locale(l.locale).format("dd"),_=c.day(),y=f==s.format(n)?"today":"",p=f==D?"middleDay":"",(l.disabledDays.indexOf(f)>-1||l.disabledWeekDays.indexOf(_)>-1)&&(b="disabledDay"),i+=['<td class="day_cell '+y+" "+p+" "+b+'" data-cellDate="'+f+'">','<span class="dia_semana">'+u+"</span>",'<span class="dia">'+m+"</span>",'<span class="mes">'+v+"</span>","</td>"].join("");a.find(".rescalendar_day_cells").html(i),function(t){t.find("td.day_cell").on("click",function(a){var e=a.currentTarget.attributes["data-cellDate"].value;t.find("input.refDate").val(e),o(t,moment(e,l.format))})}(a),function(a,e,n){var o="",d=(e=l.dataKeyValues,n=l.data,[]),s="",i="",c="",f="",m={};a.find("td.day_cell").each(function(a,e){d.push(t(this).attr("data-cellDate"))});for(var u=0;u<e.length;u++){i="",date="",o+='<tr class="dataRow">',o+='<td class="firstColumn">'+(s=e[u])+"</td>";for(var _=0;_<d.length;_++)title="",date=d[_],"object"==typeof(m=r(n,s,date))?(m.title&&(title=' title="'+m.title+'" '),i='<a href="#" '+title+">&nbsp;</a>",c="hasEvent",f=m.customClass):(i=" ",c="",f=""),o+='<td data-date="'+date+'" data-name="'+s+'" class="data_cell '+c+" "+f+'">'+i+"</td>";o+="</tr>"}a.find(".rescalendar_data_rows").html(o)}(a)}function d(t,a,e){var n=t.find("input.refDate").val(),r="";r="subtract"==a?moment(n,l.format).subtract(e,"days"):moment(n,l.format).add(e,"days"),t.find("input.refDate").val(r.format(l.format)),o(t,r)}var l=t.extend({id:"rescalendar",format:"YYYY-MM-DD",refDate:moment().format("YYYY-MM-DD"),jumpSize:15,calSize:30,locale:"en",disabledDays:[],disabledWeekDays:[],dataKeyField:"name",dataKeyValues:[],data:{},lang:{init_error:"Error when initializing",no_data_error:"No data found",no_ref_date:"No refDate found",today:"Today"},template_html:function(t,a){return['<div class="rescalendar ',t.attr("id"),'_wrapper">','<div class="rescalendar_controls">','<button class="move_to_last_month"> << </button>','<button class="move_to_yesterday"> < </button>','<input class="refDate" type="text" value="'+a.refDate+'" />','<button class="move_to_tomorrow"> > </button>','<button class="move_to_next_month"> >> </button>',"<br>",'<button class="move_to_today"> '+a.lang.today+" </button>","</div>",'<table class="rescalendar_table">',"<thead>",'<tr class="rescalendar_day_cells"></tr>',"</thead>",'<tbody class="rescalendar_data_rows">',"</tbody>","</table>","</div>"].join("")}},a);return this.each(function(){var a=t(this);!function(t,a){var n;""==(t.attr("id")||"")||0==a.dataKeyValues.length?t.html(e(a.lang.init_error+": No id or dataKeyValues")):10!=a.refDate.length?t.html(e(a.lang.no_ref_date)):(n=a.template_html(t,a),t.html(n))}(a,l),o(a,l.refDate);var n=a.find(".move_to_last_month"),r=a.find(".move_to_yesterday"),s=a.find(".move_to_tomorrow"),i=a.find(".move_to_next_month"),c=a.find(".move_to_today"),f=a.find(".refDate");return n.on("click",function(t){d(a,"subtract",l.jumpSize)}),r.on("click",function(t){d(a,"subtract",1)}),s.on("click",function(t){d(a,"add",1)}),i.on("click",function(t){d(a,"add",l.jumpSize)}),f.on("blur",function(t){var e=a.find("input.refDate").val();o(a,e)}),c.on("click",function(t){var e=moment().startOf("day").format(l.format);a.find("input.refDate").val(e),o(a,e)}),this})}}(jQuery);